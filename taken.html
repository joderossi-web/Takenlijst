<!-- Filterknop -->
<div class="row">
  <div class="col s12">
    <a class="waves-effect waves-light btn modal-trigger" href="#filterModal">Filters</a>
  </div>
</div>

<!-- Modal structuur -->
<div id="filterModal" class="modal">
  <div class="modal-content">
    <h5>Filters</h5>
    <div>
      <p><strong>Verantwoordelijke:</strong></p>
      <div id="filterVerantwoordelijkeCheckboxes"></div>
    </div>
    <div>
      <p><strong>Commissie:</strong></p>
      <div id="filterCommissieCheckboxes"></div>
    </div>
    <div>
      <p><strong>Prioriteit:</strong></p>
      <div id="filterPrioriteitCheckboxes"></div>
    </div>
    <div>
      <label>
        <input type="checkbox" id="filterStatusOk">
        <span>Verberg taken met status "OK"</span>
      </label>
    </div>
    <div>
      <label>
        <input type="checkbox" id="filterGemarkeerd">
        <span>Alleen gemarkeerde taken</span>
      </label>
    </div>
  </div>
  <div class="modal-footer">
    <a href="#!" class="modal-close waves-effect waves-green btn" id="applyFiltersBtn">Pas filter toe</a>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const elems = document.querySelectorAll('.modal');
  M.Modal.init(elems);

  // Dynamische checkboxen vullen
  function vulFilterCheckboxes() {
    const verantwoordelijken = [...new Set(takenData.map(t => t.verantwoordelijke).filter(Boolean))];
    const commissies = [...new Set(takenData.map(t => t.commissie).filter(Boolean))];
    const prioriteiten = [...new Set(takenData.map(t => t.prioriteit).filter(Boolean))].sort();

    const verDiv = document.getElementById('filterVerantwoordelijkeCheckboxes');
    verDiv.innerHTML = '';
    verantwoordelijken.forEach(v => {
      const id = `ver-${v}`;
      verDiv.innerHTML += `<p><label><input name="verantwoordelijke" type="checkbox" id="${id}" value="${v}"><span>${v}</span></label></p>`;
    });

    const comDiv = document.getElementById('filterCommissieCheckboxes');
    comDiv.innerHTML = '';
    commissies.forEach(c => {
      const id = `com-${c}`;
      comDiv.innerHTML += `<p><label><input name="commissie" type="checkbox" id="${id}" value="${c}"><span>${c}</span></label></p>`;
    });

    const prioDiv = document.getElementById('filterPrioriteitCheckboxes');
    prioDiv.innerHTML = '';
    prioriteiten.forEach(p => {
      const id = `prio-${p}`;
      prioDiv.innerHTML += `<p><label><input name="prioriteit" type="checkbox" id="${id}" value="${p}"><span>${p}</span></label></p>`;
    });

    // Max 1 checkbox per type selecteren
    ['verantwoordelijke','commissie','prioriteit'].forEach(name=>{
      const checkboxes = document.querySelectorAll(`input[name="${name}"]`);
      checkboxes.forEach(cb=>{
        cb.addEventListener('change', e=>{
          if(cb.checked){
            checkboxes.forEach(other=>{
              if(other!==cb) other.checked=false;
            });
          }
        });
      });
    });
  }

  // Filter toepassen
  document.getElementById('applyFiltersBtn').addEventListener('click', ()=>{
    renderTaken();
  });

  vulFilterCheckboxes(); // bij load
});
</script>
